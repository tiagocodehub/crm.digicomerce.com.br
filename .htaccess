RewriteEngine On
RewriteBase /

# ============================================
# SUBDOMÍNIO CRM - APONTA PARA PASTA PUBLIC
# ============================================

# Verifica se o acesso é pelo subdomínio crm.digicomerce.com.br
RewriteCond %{HTTP_HOST} ^crm\.digicomerce\.com\.br$ [NC]

# Se a URL NÃO começar com /public/, redireciona para a pasta public
RewriteCond %{REQUEST_URI} !^/public/

# Redireciona todas as requisições para a pasta public
RewriteRule ^(.*)$ public/$1 [L,QSA]

# ============================================
# CONFIGURAÇÕES ADICIONAIS IMPORTANTES
# ============================================

# Protege o arquivo .htaccess
<Files .htaccess>
    Order Allow,Deny
    Deny from all
</Files>

# Previne acesso a arquivos sensíveis
<FilesMatch "\.(env|log|ini|conf|sql|bak|inc|php|twig|yml)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Configurações de cache (opcional, mas recomendado)
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/x-javascript "access plus 1 month"
    ExpiresByType application/x-shockwave-flash "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresDefault "access plus 2 days"
</IfModule>

# Compressão GZIP (melhora performance)
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Páginas de erro personalizadas (opcional)
ErrorDocument 404 /public/404.html
ErrorDocument 403 /public/403.html
ErrorDocument 500 /public/500.html